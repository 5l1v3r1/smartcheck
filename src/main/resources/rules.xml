<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Rules xmlns="http://www.smartdec.ru/SmartCheck/Conditions" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.smartdec.ru/SmartCheck/Conditions rules-grammar-schema.xsd ">
    <Rule>
        <RuleId>SOLIDITY_BALANCE_EQUALITY</RuleId>
        <Patterns>
            <Pattern patternId="5094ad">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>2</Severity>
                <XPath>//expression[expression//environmentalVariableDefinition[matches(text()[1],"^this.balance$")]][matches(text()[1],"^==$")]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_BYTES_BYTE</RuleId>
        <Patterns>
            <Pattern patternId="f13a9f">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//typeName[typeName/elementaryTypeName[text()[1]="byte"]][matches(text()[1],"^\[.*\]$")]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_CALL_VALUE</RuleId>
        <Patterns>
            <Pattern patternId="cc2e04">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>3</Severity>
                <XPath>//externalFunctionCall/externalFunctionCallNotThis/functionNameAndArgs[functionName/identifier[matches(text()[1],"^call$")]][functionName/identifier[matches(text()[1],"^value$")]][not(callArguments/callArgument)]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_DOS_WITH_THROW</RuleId>
        <Patterns>
            <Pattern patternId="637fdc">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>3</Severity>
                <XPath>//ifStatement[ifCondition//externalFunctionCall][block/statement//throwStatement or block/statement//simpleStatement/expressionStatement/expression/primaryExpression/identifier[text()[1]="revert"]]</XPath>
            </Pattern>
            <Pattern patternId="efb788">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>2</Severity>
                <XPath>//forStatement/expression//externalFunctionCall</XPath>
            </Pattern>
            <Pattern patternId="04242c">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>2</Severity>
                <XPath>//whileStatement/whileCondition//externalFunctionCall</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_ERC20_API_VIOLATION</RuleId>
        <Patterns>
            <Pattern patternId="550a42">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//contractDefinition[inheritanceSpecifier//identifier[matches(text()[1],"token","i")]]//functionDefinition[identifier[matches(text()[1],"^approve|transfer(From)?$")]][.//functionCall/internalFunctionCall/functionName/identifier[text()[1]="require"] or .//throwStatement or .//primaryExpression/identifier[text()[1]="revert"]]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_GAS_LIMIT_AND_LOOPS</RuleId>
        <Patterns>
            <Pattern patternId="f6f853">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>2</Severity>
                <XPath>//forStatement[expression[1][functionCall or expression[2]/primaryExpression/identifier]]</XPath>
            </Pattern>
            <Pattern patternId="38f6c7">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>2</Severity>
                <XPath>//whileStatement[whileCondition/descendant::*[functionCall]]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_INTEGER_DIVISION</RuleId>
        <Patterns>
            <Pattern patternId="8e0621">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//expression[expression[1]//numberLiteral][text()[1]="/"][expression[2]//numberLiteral]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_LOCKED_MONEY</RuleId>
        <Patterns>
            <Pattern patternId="30281d">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//contractDefinition[contractPartDefinition/functionDefinition/stateMutability/payableType[matches(text()[1],"^payable$")] and not(contractPartDefinition/functionDefinition//functionCall/internalFunctionCall/functionName/identifier[text()[1]="suicide"]) and not(contractPartDefinition/functionDefinition//externalFunctionCall/externalFunctionCallNotThis/functionNameAndArgs/functionName/identifier[matches(text()[1],"^transfer|send$")])]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_MALICIOUS_LIBRARIES</RuleId>
        <Patterns>
            <Pattern patternId="a0298c">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//contractDefinition[text()[1]="library"]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_PRAGMAS_VERSION</RuleId>
        <Patterns>
            <Pattern patternId="23fc32">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//pragmaDirective/pragmaValue//versionOperator</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_PRIVATE_MODIFIER</RuleId>
        <Patterns>
            <Pattern patternId="5616b2">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//stateVariableDeclaration/visibleType[text()[1]="private"]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_REDUNDANT_FALLBACK_REJECT</RuleId>
        <Patterns>
            <Pattern patternId="b85a32">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//sourceUnit[pragmaDirective/pragmaValue/version/versionConstraint[versionLiteral &gt;= "0.4.0"]]/contractDefinition/contractPartDefinition/functionFallBackDefinition[stateMutability/payableType[text()[1]="payable"]][block/statement/throwStatement]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_REENTRANCY_EXTERNAL_CALL</RuleId>
        <Patterns>
            <Pattern patternId="de222d">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>3</Severity>
                <XPath>//statement[simpleStatement/expressionStatement/expression/functionCall/externalFunctionCall][following-sibling::*[simpleStatement/expressionStatement/expression[not (functionCall/externalFunctionCall)]]]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_SEND</RuleId>
        <Patterns>
            <Pattern patternId="430636">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>2</Severity>
                <XPath>//functionName/identifier[text()[1]="send"]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_STYLE_GUIDE_VIOLATION</RuleId>
        <Patterns>
            <Pattern patternId="343033">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//eventDefinition/identifier[matches(text()[1],"^[a-z]")]</XPath>
            </Pattern>
            <Pattern patternId="b0dbcd">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//functionDefinition[identifier[matches(text()[1],"^[A-Z]")]][not(identifier =//ancestor::*/contractDefinition/identifier)]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_TIMESTAMP_DEPENDENCE</RuleId>
        <Patterns>
            <Pattern patternId="1955d9">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>2</Severity>
                <XPath>//expression[matches(text()[1],"^==|!=$")][//environmentalVariableDefinition[matches(text()[1],"^block.timestamp|now$")]]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_TX_ORIGIN</RuleId>
        <Patterns>
            <Pattern patternId="12e802">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>2</Severity>
                <XPath>//environmentalVariableDefinition[matches(text()[1],"^tx.origin$")]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_UNCHECKED_CALL</RuleId>
        <Patterns>
            <Pattern patternId="f39eed">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>3</Severity>
                <XPath>//externalFunctionCall/externalFunctionCallNotThis[functionNameAndArgs/functionName/identifier[matches(text()[1],"^call|delegatecall|send$")]][not(ancestor::ifCondition) and not(ancestor::internalFunctionCall[functionName/identifier[matches(text()[1],"^require|assert$")]])]
                </XPath>
            </Pattern>

            <Pattern patternId="a49egh">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>3</Severity>
                <XPath>
                    //statement[simpleStatement/expressionStatement/expression[//externalFunctionCall/externalFunctionCallNotThis/functionNameAndArgs/functionName/identifier[matches(text()[1],"^call|delegatecall|send$")]][matches(text()[1],"^=$")]]
                </XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_VAR</RuleId>
        <Patterns>
            <Pattern patternId="d28aa7">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>2</Severity>
                <XPath>//variableDeclaration[typeName/elementaryTypeName[matches(text()[1],"^var$")]][expression//primaryExpression/numberLiteral[matches(text()[1],"^[0-9]+$")]]</XPath>
            </Pattern>
            <Pattern patternId="f77619">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//variableDeclaration[typeName/elementaryTypeName[matches(text()[1],"^var$")]][expression/primaryExpression/identifier]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_VISIBILITY</RuleId>
        <Patterns>
            <Pattern patternId="910067">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//contractPartDefinition/functionDefinition[not(visibleType)]</XPath>
            </Pattern>
            <Pattern patternId="b51ce0">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>1</Severity>
                <XPath>//contractPartDefinition/stateVariableDeclaration[not(visibleType)]</XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_VIEW_FUNCTIONS</RuleId>
        <Patterns>
            <Pattern patternId="189abf">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>3</Severity>
                <!--Writing to state variables - лучше сделать через флаги-->
                <!--Emitting events - лучше сделать через флаги-->
                <!--Creating other contracts - лучше сделать через флаги-->

                <XPath>
                    //functionDefinition[stateMutability/viewType][
                <!--Using selfdestruct and it's alias suicide:-->
                    block/statement//functionCall/internalFunctionCall/functionName/identifier[matches(text()[1],"^selfdestruct|suicide$")]
                or
                <!--Sending Ether via calls:-->
                    block/statement//functionCall//externalFunctionCallNotThis/functionNameAndArgs/functionName/identifier[matches(text()[1],"^send|transfer$")]

                 <!--Calling any function not marked view or pure:- лучше сделать через флаги-->

                <!--Using low-level calls:-->
                or
                    block/statement//functionCall//externalFunctionCallNotThis/functionNameAndArgs/functionName/identifier[matches(text()[1],"^call|delegatecall|callcode$")]
                or
                <!--Using inline assembly that contains certain opcodes:-->
                    block/statement//inlineAssemblyStatement]
                </XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_IS_IT_VIEW_FUNCTIONS</RuleId>
        <Patterns>
            <Pattern patternId="ad1827">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>3</Severity>
                <!--Writing to state variables - лучше сделать через флаги-->
                <!--Emitting events - лучше сделать через флаги-->
                <!--Creating other contracts - лучше сделать через флаги-->

                <XPath>
                    //functionDefinition[not(stateMutability/viewType)][
                    <!--Using selfdestruct and it's alias suicide:-->
                    not(block/statement//functionCall/internalFunctionCall/functionName/identifier[matches(text()[1],"^selfdestruct|suicide$")])
                    and
                    <!--Sending Ether via calls:-->
                    not(block/statement//functionCall//externalFunctionCallNotThis/functionNameAndArgs/functionName/identifier[matches(text()[1],"^send|transfer$")])

                    <!--Calling any function not marked view or pure:- лучше сделать через флаги-->

                    <!--Using low-level calls:-->
                    and
                    not(block/statement//functionCall//externalFunctionCallNotThis/functionNameAndArgs/functionName/identifier[matches(text()[1],"^call|delegatecall|callcode$")])
                    and
                    <!--Using inline assembly that contains certain opcodes:-->
                    not(block/statement//inlineAssemblyStatement)]
                </XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_PURE_FUNCTIONS</RuleId>
        <Patterns>
            <Pattern patternId="11314f">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>3</Severity>
                <XPath>
                    //functionDefinition[stateMutability/pureType][
                    <!--Accessing this.balance or <address>.balance: using .balance or this.balance-->
                    block/statement//functionCall//externalFunctionCallNotThis/functionNameAndArgs[matches(text()[1],"^.$")][functionName/identifier[matches(text()[1],"^balance$")]]
                    or //environmentalVariableDefinition[matches(text()[1],"^this.balance$")]
                    <!--Accessing any of the members of block, tx, msg (with the exception of msg.sig and msg.data)-->
                    or
                    //environmentalVariableDefinition[matches(text()[1],"^msg.value|msg.gas|msg.sender|block.timestamp|tx.origin|block.blockhash|block.coinbase|block.difficulty|block.gaslimit|block.number|block.blockhash|block.coinbase|tx.gasprice$")]
                    or
                    <!--Using selfdestruct and it's alias suicide:-->
                    block/statement//functionCall/internalFunctionCall/functionName/identifier[matches(text()[1],"^selfdestruct|suicide$")]
                    or
                    <!--Sending Ether via calls:-->
                    block/statement//functionCall//externalFunctionCallNotThis/functionNameAndArgs/functionName/identifier[matches(text()[1],"^send|transfer$")]
                    <!--Using low-level calls:-->
                    or
                    block/statement//functionCall//externalFunctionCallNotThis/functionNameAndArgs/functionName/identifier[matches(text()[1],"^call|delegatecall|callcode$")]
                    or
                    <!--Using inline assembly that contains certain opcodes:-->
                    block/statement//inlineAssemblyStatement
                    ]
                </XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_IS_IT_PURE_FUNCTIONS</RuleId>
        <Patterns>
            <Pattern patternId="bca409">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>3</Severity>
                <XPath>
                    //functionDefinition[not(stateMutability/pureType)][
                    <!--Accessing this.balance or <address>.balance: using .balance or this.balance-->
                    not(block/statement//functionCall//externalFunctionCallNotThis/functionNameAndArgs[matches(text()[1],"^.$")][functionName/identifier[matches(text()[1],"^balance$")]])
                    and not(block/statement//environmentalVariableDefinition[matches(text()[1],"^this.balance$")])
                    <!--Accessing any of the members of block, tx, msg (with the exception of msg.sig and msg.data)-->
                    and
                    not(block/statement//environmentalVariableDefinition[matches(text()[1],"^msg.value|msg.gas|msg.sender|block.timestamp|tx.origin|block.blockhash|block.coinbase
                    |block.difficulty|block.gaslimit|block.number|block.blockhash|block.coinbase|tx.gasprice$")])
                    and
                    <!--Using selfdestruct and it's alias suicide:-->
                    not(block/statement//functionCall/internalFunctionCall/functionName/identifier[matches(text()[1],"^selfdestruct|suicide$")])
                    and
                    <!--Sending Ether via calls:-->
                    not(block/statement//functionCall//externalFunctionCallNotThis/functionNameAndArgs/functionName/identifier[matches(text()[1],"^send|transfer$")])
                    <!--Using low-level calls:-->
                    and
                    not(block/statement//functionCall//externalFunctionCallNotThis/functionNameAndArgs/functionName/identifier[matches(text()[1],"^call|delegatecall|callcode$")])
                    and
                    <!--Using inline assembly that contains certain opcodes:-->
                    not(block/statement//inlineAssemblyStatement)
                    ]
                </XPath>
            </Pattern>
        </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_ADDRESS_HARDCODED</RuleId>
            <Patterns>
                <Pattern patternId="adc165">
                    <Categories>
                         <Category>Solidity</Category>
                    </Categories>
                    <Severity>3</Severity>
                    <XPath>
                        //addressContract[string-length(addressNumber)=42]
                    </XPath>
                </Pattern>
                <Pattern patternId="b140cd">
                    <Categories>
                        <Category>Solidity</Category>
                    </Categories>
                    <Severity>3</Severity>
                    <XPath>
                        //addressContract[string-length(addressNumber) lt 42]
                    </XPath>
                </Pattern>
            </Patterns>
    </Rule>
    <Rule>
        <RuleId>SOLIDITY_RANDOMNESS_NOW</RuleId>
        <Patterns>
            <Pattern patternId="afb67a">
                <Categories>
                    <Category>Solidity</Category>
                </Categories>
                <Severity>3</Severity>
                <XPath>
                    //statement[//expression[matches(text()[1],"^=$")][//environmentalVariableDefinition[matches(text()[1],"^now$")]]]
                </XPath>
            </Pattern>
        </Patterns>
    </Rule>
</Rules>
